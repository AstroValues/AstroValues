<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catch & Tame Values</title>
    <style>
        :root {
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f8fafc;
            --accent: #38bdf8;
            --border: #334155;
            --rarity-secret: #ffffff;
            --rarity-exclusive: #c084fc;
            --rarity-mythic: #ef4444;
            --shadow-secret: 0 0 10px rgba(255, 255, 255, 0.8);
            --shadow-exclusive: 0 0 10px rgba(192, 132, 252, 0.8);
            --trend: #fbbf24;
        }

        * { box-sizing: border-box; margin:0; padding:0; font-family:'Inter', sans-serif; }
        body { background:var(--bg); color:var(--text); line-height:1.5; overflow-x: hidden; }

        nav { background:#020617; padding:1rem; display:flex; justify-content:space-between; align-items:center; position:sticky; top:0; border-bottom:1px solid #1e293b; z-index:100; }
        .logo { color:var(--accent); font-weight:bold; letter-spacing:1px; }
        .nav-menu { display:none; flex-direction:column; position:absolute; top:100%; left:0; width:100%; background:#020617; padding:1rem; border-bottom:1px solid #1e293b; }
        .nav-menu.active { display:flex; }
        .nav-link { color:var(--text); text-decoration:none; padding:0.75rem 0; cursor:pointer; transition: 0.2s; }
        .nav-link:hover { color:var(--accent); }
        .hamburger { font-size:1.5rem; cursor:pointer; background:none; border:none; color:white; }

        section { padding:2rem 1rem; max-width:1200px; margin:0 auto; transition: opacity 0.3s ease-in-out; }
        .hidden { display:none; opacity: 0; }

        .category-title { margin: 2rem 0 1rem; border-bottom: 2px solid var(--border); padding-bottom: 0.5rem; display: flex; align-items: center; justify-content: space-between; }

        .search-container { margin: 1rem 0; position: relative; }
        .search-bar { width: 100%; padding: 0.8rem 1rem; background: var(--card); border: 1px solid var(--border); border-radius: 0.5rem; color: white; font-size: 1rem; transition: border-color 0.2s; }
        .search-bar:focus { outline: none; border-color: var(--accent); }

        .card-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:1rem; }
        .card { 
            background:var(--card); 
            border-radius:0.75rem; 
            padding:1rem; 
            text-align:center; 
            border:1px solid transparent; 
            transition:0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            cursor:pointer;
            position: relative;
        }
        .card:hover { transform:translateY(-8px) scale(1.02); border-color:var(--accent); box-shadow: 0 0 15px rgba(56, 189, 248, 0.3); }
        .card-value { color:#10b981; font-weight:600; margin:0.25rem 0; }
        .card-info { color:#94a3b8; font-size:0.75rem; margin-top:2px; }
        .rarity-secret { color:var(--rarity-secret); font-weight:800; text-shadow: var(--shadow-secret); }
        .rarity-exclusive { color:var(--rarity-exclusive); font-weight:800; text-shadow: var(--shadow-exclusive); }
        .rarity-mythic { color:var(--rarity-mythic); font-weight:800; }

        .trending-badge { position: absolute; top: 0.5rem; right: 0.5rem; background: var(--trend); color: #000; font-size: 0.6rem; font-weight: 800; padding: 2px 6px; border-radius: 4px; text-transform: uppercase; }

        .placeholder {
            width:100%; aspect-ratio:1/1; background:#334155; display:flex; align-items:center; justify-content:center;
            border-radius:8px; margin-bottom:0.75rem; color:white; font-size:0.7rem; text-align:center; padding:4px;
            overflow: hidden;
        }
        .item-img { width:100%; height:100%; object-fit:contain; }

        .calculator-container { display:grid; gap:2rem; grid-template-columns:1fr; }
        @media(min-width:768px){ 
            .calculator-container { grid-template-columns:1fr 1fr; } 
            .nav-menu{ display:flex; flex-direction:row; position:static; gap:2rem; border:none; padding:0; } 
            .hamburger{display:none;} 
            .card-grid{grid-template-columns:repeat(auto-fill,minmax(180px,1fr));} 
        }

        .offer-side { background:#020617; padding:1.5rem; border-radius:1rem; border:1px solid #1e293b; }
        .side-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .side-title { font-weight:600; text-transform:uppercase; letter-spacing:1px; }
        .add-btn { background: var(--accent); color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 0.4rem; cursor: pointer; font-weight: bold; transition: transform 0.2s; }
        .add-btn:hover { transform: scale(1.1); }
        .total-value { color:#10b981; font-weight:bold; font-size:1.75rem; margin-bottom: 1.5rem; border-bottom:2px solid #1e293b; padding-bottom:0.5rem; }

        .trade-items { display: flex; flex-direction: column; gap: 0.75rem; }
        .trade-item { background: var(--card); padding: 0.75rem; border-radius: 0.5rem; display: flex; gap: 1rem; align-items: center; border: 1px solid var(--border); }
        .item-thumb { width: 50px; height: 50px; border-radius: 4px; background: #334155; display: flex; align-items: center; justify-content: center; overflow: hidden; flex-shrink: 0; }
        .item-thumb img { width: 100%; height: 100%; object-fit: contain; }
        .item-details { display: flex; flex-direction: column; flex-grow: 1; overflow: hidden; }
        .remove-btn { color: #ef4444; background: none; border: none; cursor: pointer; font-size: 1.2rem; }

        .diff-indicator { text-align:center; padding:2rem; font-size:1.5rem; font-weight:800; grid-column:1/-1; background:#020617; border-radius:1rem; border:1px dashed #334155; margin-top:1rem; }

        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 1rem; backdrop-filter: blur(4px); }
        .modal-content { background: var(--card); padding: 2rem; border-radius: 1rem; width: 100%; max-width: 450px; max-height: 90vh; overflow-y: auto; position: relative; }
        .modal-content h3 { margin-bottom: 1rem; color: var(--accent); }
        .modal-content select, .modal-content button.confirm, .modal-content button.category-btn { width: 100%; padding: 0.75rem; margin-bottom: 1rem; border-radius: 0.5rem; background: var(--bg); color: white; border: 1px solid var(--border); cursor: pointer; }
        .modal-content button.confirm { background: var(--accent); border: none; font-weight: bold; }
        .modal-content button.cancel { background: none; border: none; color: #94a3b8; cursor: pointer; width: 100%; margin-top: 0.5rem; }

        .active-btn { background: var(--accent) !important; border-color: white !important; }
        .detail-img-box { width: 150px; height: 150px; background: #020617; border-radius: 1rem; margin: 0 auto 1.5rem; display: flex; align-items: center; justify-content: center; border: 1px solid var(--border); overflow: hidden; }
        .detail-img-box img { max-width: 90%; max-height: 90%; object-fit: contain; }
    </style>
</head>
<body>

<nav>
    <div class="logo">C&T VALUES</div>
    <button class="hamburger" id="hamburger">☰</button>
    <div class="nav-menu" id="nav-menu">
        <a class="nav-link" onclick="showSection('value-list')">Value List</a>
        <a class="nav-link" onclick="showSection('calculator')">Trade Calculator</a>
    </div>
</nav>

<section id="value-list">
    <h2>Value List</h2>
    <div style="text-align:center; margin-bottom:1rem;">
        <a href="https://discord.gg/dU86TcTQ8" target="_blank" style="display:inline-block; padding:0.5rem 1rem; background:#5865F2; color:white; border-radius:0.5rem; font-weight:bold; text-decoration:none;">Join Our Discord</a>
    </div>

    <div class="search-container">
        <input type="text" class="search-bar" id="value-search" placeholder="Search pets or eggs..." onkeyup="filterValueList()">
    </div>

    <h3 class="category-title">Trending Now</h3>
    <div class="card-grid" id="grid-trending"></div>

    <h3 class="category-title">Secrets</h3>
    <div class="card-grid" id="grid-secrets"></div>

    <h3 class="category-title">Christmas Pets</h3>
    <div class="card-grid" id="grid-christmas"></div>

    <h3 class="category-title">Exclusive Pets</h3>
    <div class="card-grid" id="grid-exclusive"></div>

    <h3 class="category-title">Prehistoric Pets</h3>
    <div class="card-grid" id="grid-prehistoric"></div>

    <h3 class="category-title">Mythic Pets</h3>
    <div class="card-grid" id="grid-mythic"></div>

    <h3 class="category-title">Eggs</h3>
    <div class="card-grid" id="grid-eggs"></div>
</section>

<section id="calculator" class="hidden">
    <h2>Trade Calculator</h2>
    <div class="calculator-container">
        <div class="offer-side" id="side-left">
            <div class="side-header">
                <div class="side-title">Your Offer</div>
                <button class="add-btn" onclick="openInitialModal('left')">+</button>
            </div>
            <div class="total-value" id="total-left">0</div>
            <div class="trade-items" id="items-left"></div>
        </div>
        <div class="offer-side" id="side-right">
            <div class="side-header">
                <div class="side-title">Their Offer</div>
                <button class="add-btn" onclick="openInitialModal('right')">+</button>
            </div>
            <div class="total-value" id="total-right">0</div>
            <div class="trade-items" id="items-right"></div>
        </div>
    </div>
</section>

<!-- Modals -->
<div class="modal" id="initial-modal">
    <div class="modal-content">
        <h3>What are you adding?</h3>
        <button class="confirm" onclick="selectCategory('pet')">Pet</button>
        <button class="confirm" onclick="selectCategory('egg')">Egg</button>
        <button class="cancel" onclick="closeModal('initial-modal')">Cancel</button>
    </div>
</div>

<div class="modal" id="item-modal">
    <div class="modal-content">
        <h3 id="item-modal-title">Select Item</h3>
        <input type="text" class="search-bar" id="modal-search" placeholder="Filter items..." onkeyup="filterModalItems()" style="margin-bottom: 1rem;">
        <div id="item-list" style="max-height: 300px; overflow-y: auto; display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem;"></div>
        <button class="cancel" onclick="closeModal('item-modal')">Back</button>
    </div>
</div>

<div class="modal" id="stats-modal">
    <div class="modal-content">
        <h3 id="stats-modal-title">Stats</h3>
        <div class="detail-img-box" id="stats-img-box"></div>
        <div id="pet-stats-controls">
            <label>Size:</label>
            <div id="size-options" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem;"></div>
            <label>Mutations:</label>
            <div id="mutation-options" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem;"></div>
        </div>
        <div id="egg-stats-controls" class="hidden">
            <p style="text-align: center; color: #94a3b8; margin-bottom: 1rem;">Base Egg Value</p>
        </div>
        <div style="margin-top: 1rem; padding: 0.75rem; background: var(--bg); border-radius: 0.5rem; text-align: center; border: 1px solid var(--border);">
            Total: <span id="temp-total-val" style="color: #10b981; font-weight: bold;">0</span>
        </div>
        <button id="add-to-trade-btn" class="confirm" onclick="finishAddingItem()" style="margin-top: 1rem;">Add to Trade</button>
        <button class="cancel" onclick="closeModal('stats-modal')">Cancel</button>
    </div>
</div>

<script>
// --- MULTIPLIER CONFIGURATION ---
// Customize multipliers for specific pets here.
// Eggs are always 1x and ignore these.
const customMultipliers = {
    "Evil Feep": {
        sizes: [
            {name:"Normal", mult:1}, {name:"Tiny", mult:1.3}, {name:"Big", mult:1.6}, {name:"Huge", mult:2.0}, {name:"Collosal", mult:2.5}
        ],
        mutations: [
            {name:"Shiny", mult:2.5}, {name:"Albino", mult:1.5}, {name:"Gold", mult:2.0}, {name:"Rainbow", mult:2.5}, {name:"Neon", mult:3.0}
        ]
    },
    "Infernal Hydra": {
        sizes: [
            {name:"Normal", mult:1}, {name:"Tiny", mult:1.5}, {name:"Big", mult:2.0}, {name:"Huge", mult:3.0}, {name:"Collosal", mult:5.0}
        ],
        mutations: [
            {name:"Shiny", mult:5.0}, {name:"Neon", mult:10.0}
        ]
    },
    "Christmas Dragon": {
        sizes: [
            {name:"Normal", mult:1}, {name:"Tiny", mult:1.2}, {name:"Big", mult:1.4}, {name:"Huge", mult:1.8}, {name:"Collosal", mult:2.2}
        ],
        mutations: [
            {name:"Shiny", mult:2.2}, {name:"Neon", mult:4.0}
        ]
    },
    "Nugget": {
        sizes: [
            {name:"Normal", mult:1}, {name:"Tiny", mult:2.0}, {name:"Big", mult:3.0}, {name:"Huge", mult:5.0}, {name:"Collosal", mult:10.0}
        ],
        mutations: [
            {name:"Shiny", mult:10.0}, {name:"Neon", mult:25.0}
        ]
    }
};

const defaultSizes = [
    {name:"Normal", mult:1}, {name:"Tiny", mult:1.25}, {name:"Big", mult:1.5}, {name:"Huge", mult:1.75}, {name:"Collosal", mult:2}
];

const defaultMutations = [
    {name:"Shiny", mult:2}, {name:"Albino", mult:1.25}, {name:"Gold", mult:1.5}, {name:"Rainbow", mult:1.75}, {name:"Glass", mult:1.7}, 
    {name:"Cosmic", mult:1.1}, {name:"Charged", mult:1.1}, {name:"Frozen", mult:1.25}, {name:"Volcanic", mult:1.5}, {name:"Seabound", mult:1.1}, {name:"Neon", mult:2.5}
];

// --- TREND SETTERS ---
const trendSetters = ["Nugget", "Evil Feep", "Christmas Dragon", "Infernal Hydra",];

const items = {
    secrets: [
        {name:"Nugget", val:650, demand:5, rarity:"Secret", img: "images/nugget.png"},
        {name:"Ethdaniel", val:150, demand:3, rarity:"Secret", img: "images/ethdaniel.png"},
        {name:"Giant Duck", val:100, demand:4, rarity:"Secret", img: "images/giantduck.png"},
        {name:"Dingrat", val:50, demand:2, rarity:"Secret", img: "images/dingrat.png"},
        {name:"Giant Worm", val:87.5, demand:3.5, rarity:"Secret", img: "images/giantworm.png"},
        {name:"Feep", val:75, demand:2, rarity:"Secret", img: "images/feep.png"},
        {name:"404 Goat", val:50, demand:1, rarity:"Secret", img: "images/404goat.png"},
    ],
    christmas: [
        {name:"Christmas Dragon", val:1500, demand:5, rarity:"Exclusive", img: "images/christmasdragon.png"},
        {name:"Mammoth", val:320, demand:2.5, rarity:"Exclusive", img: "images/mammoth.png"},
        {name:"Narwhal", val:250, demand:3, rarity:"Exclusive", img: "images/narwhal.png"},
        {name:"Musk Ox", val:100, demand:2, rarity:"Exclusive", img: "images/muskox.png"},
        {name:"Arctic Fox", val:50, demand:5, rarity:"Exclusive", img: "images/arcticfox.png"},
    ],
    exclusive_egg_1: [
        {name:"Evil Feep", val:2625, demand:5, rarity:"Exclusive", img: "images/evilfeep.png"},
        {name:"Ice Dragon", val:335, demand:3, rarity:"Exclusive", img: "images/icedragon.png"},
        {name:"Phoenix", val:150, demand:2.5, rarity:"Exclusive", img: "images/phoenix.png"},
        {name:"Lava Bear", val:100, demand:2.5, rarity:"Exclusive", img: "images/lavabear.png"},
    ],
    prehistoric: [
        {name:"Infernal Hydra", val:3000, demand:4, rarity:"Exclusive", img: "images/infernalhydra.png"},
        {name:"Infernal Axolotl", val:425, demand:3.75, rarity:"Exclusive", img: "images/infernalaxolotl.png"},
        {name:"Butterfly", val:175, demand:3.5, rarity:"Exclusive", img: "images/butterfly.png"},
        {name:"Dragonfly", val:180, demand:3, rarity:"Exclusive", img: "images/dragonfly.png"},
        {name:"Pterodactyl", val:50, demand:2, rarity:"Exclusive", img: "images/pterodactyl.png"},
    ],
    mythic: [
        {name:"Lightning Dragon", val:220, demand:4.5, rarity:"Mythic", img: "images/lightningdragon.png"},
        {name:"Celestial Hydra", val:145, demand:4, rarity:"Mythic", img: "images/celestialhydra.png"},
        {name:"Yeti", val:60, demand:1.5, rarity:"Mythic", img: "images/yeti.png"},
        {name:"Cosmic Griffin", val:85, demand:3.5, rarity:"Mythic", img: "images/cosmicgriffin.png"},
        {name:"Griffin", val:95, demand:2, rarity:"Mythic", img: "images/griffin.png"},
        {name:"Basilik", val:95, demand:2, rarity:"Mythic", img: "images/basilik.png"},
        {name:"Emerald Dragon", val:75, demand:2, rarity:"Mythic", img: "images/emeralddragon.png"},
        {name:"Brontosaurus", val:40, demand:2, rarity:"Mythic", img: "images/brontosaurus.png"},
        {name:"T-Rex", val:55, demand:2.5, rarity:"Mythic", img: "images/t-rex.png"},
        {name:"Mantis", val:40, demand:2, rarity:"Mythic", img: "images/mantis.png"},
        {name:"Hydra", val:110, demand:3, rarity:"Mythic", img: "images/hydra.png"},
        {name:"Celestial Griffin", val:85, demand:3, rarity:"Mythic", img: "images/celestialgriffin.png"},
        {name:"Celestial Axolotl", val:130, demand:4, rarity:"Mythic", img: "images/celestialaxolotl.png"},
        {name:"Galaxy Axolotl", val:112.5, demand:4, rarity:"Mythic", img: "images/galaxyaxolotl.png"},
        {name:"Galaxy Kitsune", val:112.5, demand:3.5, rarity:"Mythic", img: "images/galaxykitsune.png"},
        {name:"Cerberus", val:17.5, demand:1.5, rarity:"Mythic", img: "images/cerberus.png"},
        {name:"Red Fox", val:15, demand:1.5, rarity:"Mythic", img: "images/redfox.png"},
        {name:"Kitsune", val:12.5, demand:1, rarity:"Mythic", img: "images/kitsune.png"},
        {name:"Axolotl", val:12.5, demand:1, rarity:"Mythic", img: "images/axolotl.png"},
        {name:"Megalodon", val:70, demand:2.5, rarity:"Mythic", img: "images/megalodon.png"},
        {name:"Kraken", val:65, demand:2, rarity:"Mythic", img: "images/kraken.png"}
    ],
    eggs: [
        {name:"Xmas Egg", val:175, demand:5, rarity:"Exclusive", isEgg: true, img: "images/xmasegg.png"},
        {name:"Exclusive Egg", val:125, demand:4, rarity:"Exclusive", isEgg: true, img: "images/exclusiveegg.png"},
        {name:"Prehistoric Egg", val:150, demand:4, rarity:"Exclusive", isEgg: true, img: "images/prehistoricegg.png"},
        {name:"Celestial Hydra Egg", val:125, demand:4, rarity:"Mythic", isEgg: true, img: "images/celestialhydraegg.png"},
        {name:"Hydra Egg", val:110, demand:3.5, rarity:"Mythic", isEgg: true, img: "images/hydraegg.png"},
        {name:"Celestial Axolotl Egg", val:115, demand:4.5, rarity:"Mythic", isEgg: true, img: "images/celestialaxolotlegg.png"},
        {name:"Celestial Griffin Egg", val:85, demand:2.5, rarity:"Mythic", isEgg: true, img: "images/celestialgriffinegg.png"},
        {name:"Galaxy Axolotl Egg", val:100, demand:4, rarity:"Mythic", isEgg: true, img: "images/galaxyaxolotlegg.png"},
        {name:"Galaxy Kitsune Egg", val:90, demand:3.5, rarity:"Mythic", isEgg: true, img: "images/galaxykitsuneegg.png"},
    ]
};

let trades = { left: [], right: [] };
let activeSide = null;
let currentItem = null;
let currentSizeMult = 1;
let currentMutMults = [];

function formatVal(v){ return v>=1000 ? (v/1000).toFixed(1)+'K' : v; }

function getPetImgs(){
    const all = [];
    for(let cat in items) all.push(...items[cat]);
    return all;
}

function renderValueList(filter = ''){
    const trendingGrid = document.getElementById('grid-trending');
    trendingGrid.innerHTML = '';
    const allItems = getPetImgs();
    const trendingItems = allItems.filter(i => trendSetters.includes(i.name));
    trendingItems.forEach(item => {
        trendingGrid.innerHTML += createCardHTML(item, true);
    });

    const map = {
        secrets: 'grid-secrets',
        christmas: 'grid-christmas',
        exclusive_egg_1: 'grid-exclusive',
        prehistoric: 'grid-prehistoric',
        mythic: 'grid-mythic',
        eggs: 'grid-eggs'
    };
    for(let cat in map){
        const g = document.getElementById(map[cat]);
        g.innerHTML = '';
        const filtered = items[cat].filter(i => i.name.toLowerCase().includes(filter.toLowerCase()));
        filtered.forEach(item => {
            g.innerHTML += createCardHTML(item);
        });
        g.previousElementSibling.style.display = filtered.length > 0 ? 'block' : 'none';
    }
}

function createCardHTML(item, isTrending = false){
    const trendingBadge = isTrending || trendSetters.includes(item.name) ? '<div class="trending-badge">Trending</div>' : '';
    return `
        <div class="card" onclick='openStatsModal(${JSON.stringify(item)})'>
            ${trendingBadge}
            <div class="placeholder"><img src="${item.img}" class="item-img" onerror="this.src='https://placehold.co/100x100/1e293b/white?text=${item.name.split(' ')[0]}'"></div>
            <div class="rarity-${item.rarity.toLowerCase()}">${item.name}</div>
            <div class="card-value">${formatVal(item.val)}</div>
            <div class="card-info">Demand: ${item.demand}/5</div>
        </div>
    `;
}

function filterValueList(){
    const query = document.getElementById('value-search').value;
    renderValueList(query);
}

function showSection(id){
    document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
    document.getElementById('nav-menu').classList.remove('active');
}

document.getElementById('hamburger').onclick = ()=>document.getElementById('nav-menu').classList.toggle('active');

function openInitialModal(side){
    activeSide = side;
    document.getElementById('initial-modal').style.display = 'flex';
}

function closeModal(id){ document.getElementById(id).style.display = 'none'; }

function selectCategory(type){
    closeModal('initial-modal');
    const modal = document.getElementById('item-modal');
    document.getElementById('modal-search').value = '';
    const pool = type === 'egg' ? items.eggs : getPetImgs().filter(i => !i.isEgg);
    window.lastModalPool = pool;
    renderModalItems(pool);
    modal.style.display = 'flex';
}

function renderModalItems(pool){
    const list = document.getElementById('item-list');
    list.innerHTML = '';
    pool.forEach(item => {
        const btn = document.createElement('button');
        btn.textContent = item.name;
        btn.className = 'category-btn';
        btn.onclick = () => openStatsModal(item);
        list.appendChild(btn);
    });
}

function filterModalItems(){
    const q = document.getElementById('modal-search').value.toLowerCase();
    const filtered = window.lastModalPool.filter(i => i.name.toLowerCase().includes(q));
    renderModalItems(filtered);
}

function openStatsModal(item){
    currentItem = item;
    currentSizeMult = 1;
    currentMutMults = [];
    closeModal('item-modal');
    const modal = document.getElementById('stats-modal');
    document.getElementById('stats-modal-title').textContent = item.name;
    document.getElementById('stats-img-box').innerHTML = `<img src="${item.img}" onerror="this.src='https://placehold.co/150x150/020617/white?text=${item.name.split(' ')[0]}'">`;
    
    const isEgg = item.isEgg;
    document.getElementById('pet-stats-controls').className = isEgg ? 'hidden' : '';
    document.getElementById('egg-stats-controls').className = isEgg ? '' : 'hidden';
    
    if(!isEgg){
        const pool = customMultipliers[item.name] || { sizes: defaultSizes, mutations: defaultMutations };
        const sizeOpts = document.getElementById('size-options');
        sizeOpts.innerHTML = '';
        pool.sizes.forEach(s => {
            const btn = document.createElement('button');
            btn.textContent = s.name;
            btn.className = s.mult === 1 ? 'category-btn active-btn' : 'category-btn';
            btn.onclick = (e) => {
                document.querySelectorAll('.size-btn-active').forEach(b => b.classList.remove('active-btn'));
                btn.classList.add('active-btn');
                currentSizeMult = s.mult;
                updateTempTotal();
            };
            btn.classList.add('size-btn-active');
            sizeOpts.appendChild(btn);
        });

        const mutOpts = document.getElementById('mutation-options');
        mutOpts.innerHTML = '';
        pool.mutations.forEach(m => {
            const btn = document.createElement('button');
            btn.textContent = m.name;
            btn.className = 'category-btn';
            btn.onclick = () => {
                const idx = currentMutMults.indexOf(m.mult);
                if(idx > -1) {
                    currentMutMults.splice(idx, 1);
                    btn.classList.remove('active-btn');
                } else {
                    currentMutMults.push(m.mult);
                    btn.classList.add('active-btn');
                }
                updateTempTotal();
            };
            mutOpts.appendChild(btn);
        });
    }
    updateTempTotal();
    modal.style.display = 'flex';
}

function updateTempTotal(){
    let total = currentItem.val * currentSizeMult;
    currentMutMults.forEach(m => total *= m);
    document.getElementById('temp-total-val').textContent = formatVal(total);
}

function finishAddingItem(){
    if(!activeSide) { closeModal('stats-modal'); return; }
    let val = currentItem.val * currentSizeMult;
    currentMutMults.forEach(m => val *= m);
    
    trades[activeSide].push({
        name: currentItem.name,
        rarity: currentItem.rarity,
        val: val,
        img: currentItem.img,
        details: currentItem.isEgg ? 'Egg' : 'Custom Stats'
    });
    closeModal('stats-modal');
    renderTrades();
}

function removeTradeItem(side, idx){
    trades[side].splice(idx, 1);
    renderTrades();
}

function renderTrades(){
    ['left', 'right'].forEach(side => {
        const container = document.getElementById(`items-${side}`);
        container.innerHTML = '';
        let total = 0;
        trades[side].forEach((item, idx) => {
            total += item.val;
            const div = document.createElement('div');
            div.className = 'trade-item';
            div.innerHTML = `
                <div class="item-thumb"><img src="${item.img}" onerror="this.src='https://placehold.co/50x50/334155/white?text=${item.name[0]}'"></div>
                <div class="item-details">
                    <span class="rarity-${item.rarity.toLowerCase()}" style="font-weight:bold">${item.name}</span>
                    <span style="font-size:0.7rem; color:#94a3b8">${item.details}</span>
                    <span style="color:#10b981; font-weight:600">${formatVal(item.val)}</span>
                </div>
                <button class="remove-btn" onclick="removeTradeItem('${side}', ${idx})">×</button>
            `;
            container.appendChild(div);
        });
        document.getElementById(`total-${side}`).innerText = formatVal(total);
    });
    updateFairness();
}

function updateFairness(){
    const left = trades.left.reduce((acc, i) => acc + i.val, 0);
    const right = trades.right.reduce((acc, i) => acc + i.val, 0);
    const diffInd = document.getElementById('diff-indicator');
    if(!diffInd) return;
    if(left === 0 && right === 0) diffInd.innerText = 'Add items to calculate';
    else {
        const diff = right - left;
        const p = (diff / left) * 100;
        diffInd.innerText = p > 15 ? 'HUGE WIN' : p < -15 ? 'HUGE LOSS' : 'FAIR TRADE';
    }
}

renderValueList();
</script>
</body>
</html>
